% aktool(1)
%
% 18 июля 2020 г.

НАЗВАНИЕ
========

aktool - консольная утилита для шифрования и контроля целостности
данных, вычисления и проверки электронной подписи, работы с ключевой
информацией.

СИНТАКСИС
=========

Синтаксис выполнения программы

aktool **команда** \[ опции \] \[ файл или каталог \] \...

ОПИСАНИЕ
========

Утилита предназначена для работы с секретными и открытыми ключами
криптографических преобразований, реализуемых библиотекой **libakrypt,**
а также для выполнения операций контроля целостности файлов,
шифрования/расшифрования данных, вычисления и проверки электронной
подписи.

Каждая команда определяет отдельный класс криптографических
преобразований и функциональных возможностей программы. В настоящее
время доступны следующие команды:

**a, asn1parse**
: Декодирование и печать ASN.1 данных

**i, icode**
: Вычисление контрольной суммы или имитовставки для одного или
нескольких файлов

**show**
: Вывод служебной и справочной информации

Получить подробную информацию о доступных опциях и параметрах любой
команды можно с помощью вызова


    aktool команда --help


КОНТРОЛЬ ЦЕЛОСТНОCТИ
====================

## Общее описание

Команда **icode** позволяет вычислять контрольные суммы или имитовставки
для одного или нескольких файлов. В случае указания в командной строке
имени каталога контрольные суммы или имитовставки будут подсчитаны для
всех доступных для чтения файлов в указанном каталоге.

Перечень доступный алгоритмов имитозащиты и вычисления контрольной суммы
может быть получен с помощью следующего вызова.


    aktool show --oids


В отличие от контрольной суммы, при вычислении имитовставки в
обязательном порядке должен быть использован секретный ключ. Данный
ключ может быть:

 - предварительно создан пользователем,
 - выработан в процессе работы из заданного пользователем пароля,
 - указан в явном виде.

Способ передачи ключа в утилиту aktool определяется ее опциями.

Поскольку некоторые алгоритмы вычисления имитовставки накладывают
ограничения на объем информации, обрабатываемой на одном ключе, то для
таких алгоритмов вычисление имитоставок от очень больших
файлов может приводить к ошибке. В этом случае вместо имитовставки
выводится значение **skipped.** Если Вам необходимо вычислять
имитовставки файлов с произвольной, сколь угодно большой длиной, то
используйте следующие алгоритмы: **hmac-streebog256, hmac-streebog512**.

## Опции команды icode

\-a, \--algorithm \<ni\>
: Опция позволяет указать задаваемый параметром **ni** (name or identifier)
алгоритм, который будет использован для вычисления контрольной суммы или имитовставки.
В качестве параметра может выступать имя алгоритма, например **streebog512**, или идентификатор
алгоритма \- последовательность целых чисел, разделенный точками.
В случае, когда опция не определена, для вычисления контрольной суммы
используется функция хеширования \"Стрибог256\", регламентированная
национальным стандартом ГОСТ Р 34.11-2012.


\-c, \--check \<file\>
: Опция позволяет проверить контрольные суммы или имитовставки для
одного или нескольких файлов. Данные суммы должны быть вычислены
заранее и сохранены в файле **file.** Если при проверке используется
алгоритм, отличный от установленного по-умолчанию, необходимо указать
его имя или идентификатор с помощью опции **-a**. Также, при необходимости,
нужно указать используемый ключ.


\-o, \--output \<file\>
: Опция определяет имя файла, в который записываются вычисленные
значения контрольных сумм или имитовставок. Данный файл может быть
указан в качестве параметра опции **-c**.

\-p
: Опция указывает, что для выработки секретного ключа, используемого
при вычислении или проверке имитовставки от одного или нескольких
файлов, должен использоваться задаваемый пользователем пароль. Если
опция **password** не опредена, то программа предлагает пользователю
ввести пароль с консоли.

\--password \<pass\>
: Опция в явном виде указывает, что для выработки секретного ключа
должен использоваться пароль, определяемый последовательностью
символов **pass**. Использование данной опции не является
безопасным.

\--salt \<hexstring\>
: При генерации ключа из пароля используется криптографическая функция
PBKDF2, инициализируемая двумя значениями \- паролем и
инициализационным вектором. Данная опция позволяет определить
значение инициализационного вектора, передаваемого как
последовательность шестнадцатеричных символов.

\--salt-len \<int\>
: Опция позволяет изменить количество октетов в инициализационном
векторе, используемом в криптографической функции PBKDF2. Значение
параметра должно принимать значение от 8 до 32-х. По-умолчанию,
используется знаение 16. В случае, если инициализационный вектор,
передаваемый в программу с помощью опции **\--salt** имеет меньшую
длину, он дополняется нулями в старших октетах.

\--hexkey \<string\>
: Опция в явном виде указывает ключ, используемый для выработки
имитовставки. Ключ должен представлять собой последовательнось
шестнадцатеричных символов, не более 128 символов, длиной, что
регламентируется рекомендациями Р 50.1.113-2016. Использование
данной опции не является безопасным.

\-r, --recursive
: Опция указывает, что при вычислении контрольных сумм или
имитовставок, должна выполняться рекурсивная процедура обхода
текущего и всех вложенных каталогов. Опция имеет смысл только в том
случае, когда в аргументах вызова указано имя каталога.

\--reverse-order
: Опция указывает, что все выводимые и вводимые последовательности
октетов, должны обрабатываться в обратном порядке. Использование
данной опции целесообразно для вывода результатов в big endian
порядке следования октетов.

\--tag
: Опция указывает, что значения контрольных сумм или имитовставок
должны выводиться в формате, принятом в операционных системах
семейства BSD. В таком формате указывается не только имя файла и его
контрольная сумма, но и алгоритм, с помощью которого данная сумма
была подсчитана. Это может быть востребовано при проверке, поскольку
у пользователя пропадает необходимость в явном виде указывать
используемый алгоритм выработки контрольных сумм или имитовставок.

\-t, --template \<mask\>
: Опция указывает шаблон (маску) поиска файлов. Для задания шаблона
используются правила, аналогичные правилам, определенным для функции
*fnmatch.*

 Следующие опции имеет смысл применять только при проверке контрольных сумм или имитовставок.

\--dont-show-stat
: Опция запрещает вывод в консоль статистической информации об общем
количестве проверенных файлов, количестве успешных или неуспешных
проверок и т.п.

\--ignore-errors
: Опция запрещает останавливать процесс проверки контрольных сумм или
имитовставок в случае возникновения ошибок доступа или чтения
файлов, отсутствия файлов, содержащихся в списке и т.п.

\--quiet
: Опция запрещает вывод символов **Ok** после успешной проверки
контрольной суммы.

\--status
: Опция запрещает вывод какой-либо информации при проверке контрольных
сумм. Результат проверки возвращается в коде возврата программы
(любое отличное от нуля значение сигнализирует об ошибке).

## Примеры контроля целостности

Приведенный ниже вызов утилиты вычисляет контрольную сумму файла
file.txt с помощью установленного по умолчанию алгоритма \"Стребог256\"
и помещает результат вычислений в файл result.txt.


    aktool i file.txt -o result.txt


Следующий вызов позволяет вычислить код целостности всех файлов,
удовлетворяющих шаблону \"\*.t??\" (файлы, имеющие расширение из трех
символов, начинающееся с символа t) в текущем каталоге (на это указывает
символ \".\"), а также во всех доступных вложенных каталогах. Для
вычисления кода целостности используется алгоритм выработки имитовставки
ГОСТ Р 34.13-2015 в основе которого лежит блочный шифр \"Кузнечик\". Для
имитозащиты файлов используется ключ, вырабатываемый из пароля, который
должен быть введен пользователем.


    aktool i -rt "*.t??" -a cmac-kuznechik -p .


Следующий вызов позволяет проверить контрольные суммы, указанные в файле
result.txt. При проверке используется установленный по-умолчанию
алгоритм \"Стрибог256\". Если файл result.txt формировался с
использованием опции --tag, то для проверки будет использован
алгоритм, указанный в result.txt


    aktool i -c result.txt


Последний вызов позволяет проверить значения имитовставок, указанных в
файле result.txt При проверке используется алгоритм hmac-streebog256,
регламентированный Р 50.1.113-2016. Ключ имитозащиты вырабатывается из
пароля, указанного пользователем в командной строке в явном виде.


    aktool i -c result.txt -a hmac-streebog256 --password aQ13jzUl


## Совместимость с другими программными средствами

Известны две общедоступные утилиты, позволяющие вычислять контрольные
суммы с помощью отечественных алгоритмов хеширования. Этими утилитами
являются:

 - gost12sum ( https://github.com/gost-engine/engine ), которая входит в
состав дополнительного модуля (engine) для хорошо известной программы
**openssl**,

 - rhash ( https://github.com/rhash/RHash ).

Следующая последовательность команд позволяет продемонстрировать
эквивалентность работы всех трех утилит для алгоритма хеширования
Стрибог-256.


    echo -n hello > test.file
    aktool i test.file
    3fb0700a41ce6e41413ba764f98bf2135ba6ded516bea2fae8429cc5bdd46d6d test.file


    rhash -G test.file
    3fb0700a41ce6e41413ba764f98bf2135ba6ded516bea2fae8429cc5bdd46d6d test.file


    gost12sum test.file
    3fb0700a41ce6e41413ba764f98bf2135ba6ded516bea2fae8429cc5bdd46d6d test.file


Аналогично, для алгоритма хеширования Стрибог512, запуск следующих
команд также позволит получить одинаковое значение хэш-кода размером 512
бит.


    gost12sum -l test.file
    rhash --gost12-512 test.file
    aktool i -a streebog512 test.file


Сама программа **openssl** также позволяет вычислять контрольные суммы,
например, следующий вызов позволит получить тот же результат, но в
другом формате


    openssl dgst -md_gost12_256 test.file > result.txt
    cat result
    md_gost12_256(test.file)=3fb0700a41ce6e41413ba764f98bf2135ba6ded516bea2fae8429cc5bdd46d6d


Утилита **aktool** может не только вырабатывать контрольные суммы в
таком же формате,


    aktool i --tag test.file
    streebog256 (test.file) = 3fb0700a41ce6e41413ba764f98bf2135ba6ded516bea2fae8429cc5bdd46d6d

но и проверять файлы, подготовленные программой \*openssl\*, используя
единый синтаксис командной строки.


    aktool i -c result.txt



При имитозащите данных утилита **aktool** совместима с программой **openssl** при использовании
явно заданных ключей. Следующие вызовы используют для вычисления
имитовставки функцию HMAC-Стрибог256 и позволяют получить одинаковый
результат


    openssl dgst -md_gost12_256 -mac hmac -macopt hexkey:acabdcab0137
    test.file HMAC-md_gost12_256(test.file)=31d56cc082c4cd57955119f4cde662b4554f867fcc08ee4d59ba32d0e604180d


    aktool i -a hmac-streebog256 --hexkey acabdcab0137 --tag test.file
    hmac-streebog256 (test.file) = 31d56cc082c4cd57955119f4cde662b4554f867fcc08ee4d59ba32d0e604180d


Отметим, что в данном случае секретный ключ, используемый для вычисления
имитовставки, задается явно, в виде последовательности шестнадцатеричных
символов. Максимальная длина последовательности не должна превышать 64
октета (128 шестнадцатеричных символа). Для последовательностей меньшей
длины старшие октеты заполняются нулями.

Аналогичная совместимость поддерживается при использовании функции
HMAC-Стрибог512.


РАЗБОР ДАННЫХ В ФОРМАТЕ ASN.1
=============================

Команда **asn1parse** позволяет декодировать и выводить в консоль данные,
закодированные в формате ASN.1 структуры. В настоящее время
поддерживается разбор чистых der-последовательностей, а также
der-последовательностей, закодированных в кодировке base64 (формат
сертификатов pem).


ВЫВОД СЛУЖЕБНОЙ И ВСПОМОГАТЕЛЬНОЙ ИНФОРМАЦИИ
============================================

Команда **show** позволяет получить информацию о доступных
криптографических преобразованиях, значениях технических и
криптографических характеристик, параметрах библиотеки по-умолчанию. В
настоящий момент доступны следующие опции.

\--engines
: Опция позволяет вывести список всех типов криптографических
механизмов, которые могут быть использованы в приложениях библиотеки
**libakrypt**. К таким типам, например, относятся блочные шифры или
алгоритмы выработки имитовставки.

\--modes
: Опция позволяет вывести список всех режимов криптографических
преобразований, которыми могут быть охарактеризованы
криптографические преобразования. При этом одному криптографическому
механизму может соответствовать несколько режимов. Например, функция
хеширования имеет режим algorithm, а ее параметры \- kbox params.

\--oids
: Опция позволяет вывести список всех доступных криптографических
механизмов. Каждый механизм идентифицируется свои именем, которое
используется для его указания пользователем и/или
последовательностью чисел, разделенных точками. Последняя
последовательность называется Object IDentifier (OID) и используется
при автоматизированной обработке данных. Например, среди прочих,
будет выведена следующая информация об алгоритме блочного шифрования
Кузнечик: идентификатор, имя и тип криптографического механизма


    1.2.643.7.1.1.5.2    kuznechik    block cipher     algorithm

\--oid \<eni\>
: Опция принимает в качестве параметра произвольную строку символов
**eni** (engine, name or identifier) и выводит все доступные
криптографические механизмы, в именах или идентификаторах которых
содержится указанная строка.

\--options
: Опция выводит перечень всех криптографических параметров библиотеки,
а также их значений. К указанным параметрам относятся, например,
число блоков информации, которые могут быть зашифрованы на одном
ключе, или число итераций криптографической функции PBKDF2,
используемой для развертки ключа из пароля.

\--without-caption
: Опция запрещает печать заголовка, расшифровывающего названия
выводимых параметров и их значений.


СТАНДАРТЫ
=========

## Национальные стандарты Российской Федерации
 - ГОСТ Р 34.10-2012 \"Процессы формирования и проверки электронной цифровой подписи\",
 - ГОСТ Р 34.11-2012 \"Функция хэширования\",
 - ГОСТ Р 34.12-2015 \"Блочные шифры\",
 - ГОСТ Р 34.13-2015 \"Режимы работы блочных шифров\".

## Рекомендации по стандартизации Росстандарта России
 - Р 50.1.111-2016 \"Парольная защита ключевой информации\",
 - Р 50.1.113-2016 \"Криптографические алгоритмы, сопутствующие применению алгоритмов
   электронной цифровой подписи и функции хэширования\",
 - Р 1323565.1.023-2018 \"Использование алгоритмов ГОСТ Р 34.10-2012, ГОСТ Р 34.11-2012 в сертификате,
   списке аннулированных сертификатов (CRL) и запросе на сертификат PKCS #10 инфраструктуры открытых ключей X.509\".

ИНФОРМАЦИЯ О ПРОЕКТЕ
====================

Интернет-сайт проекта http://libakrypt.org

Исходные коды утилиты и библиотеки:
https://github.com/axelkenzo/libakrypt-0.x

АВТОРЫ
======

Axel Kenzo & The Company Of Belles Lettres (с) 2014 - 2020.
