# Принципы реализации

Далее мы опишем основные принципы и механизмы
реализации мер по защите информации,
использованные при создании исходных текстов библиотеки `libakrypt`.

## Принципы создания исходных текстов библиотеки

1. Библиотека реализует функциональное разделение исходных текстов,
что позволяет исключать из сборки блоки, функциональность которых не требуется.
В настоящее время существует несколько крупных функциональных блоков:

 * ядро, часть содержащая только арифметические операции и служебные функции библиотеки,
 * криптографический блок, содержащий реализацию всех поддерживаемых библиотекой
   криптографических примитивов,
 * блок протоколов, содержащию реализацию механизмов защищенного обмена информацией по каналам связи.

2. Библиотека следует стандарту С99 и поддерживает максимальную кросс-платформенность.
   Исходные тексты, включаемые в состав библиотеки,
   должны быть успешно скомпилированы и корректно исполнены для максимально возможного числа компиляторов
   языка С и операционных систем. Поддерживаются little endian и big endian архитектуры.

3. Библиотека использует минимально возможное
   количество внешних зависимостей. В большинстве случаев, единственной зависимостью
   является стандартная библиотека языка C. Однако это правило нарушается
   под управлением операционных систем семейства Windows, поскольку
   часть стандартного функционала (поддержка сокетов и потоков) в данной ОС вынесена
   в отдельные динамические библиотеки.

4. Библиотека использует минимальное включение кода, то есть исключение из исходных текстов
   фрагментов, которые реально не используются или предоставляют мало востребованный пользовательский интерфейс.
   Функции пользовательского интерфейса, не используемые при выполнении криптографических преобразований,
   также выведены из состава библиотеки.

5. В случае, если некоторая функциональность не может быть реализована
   без использования неэкспортируемых типов данных и функций, то данная функциональность
   включается в состав библиотеки в соответствии с данными принципами.
   Это привело к тому, что в библиотеку включены собственная реализация операций с большими целыми числами,
   собственные функции разбора сообщений в формате ASN1,
   реализация функций чтения/записи из сокетов и т.п.

6. Библиотека следует принципу максимального документирования исходных текстов,
   включая не только описание аргументов функций и возвращаемых значений,
   а также описание принципов реализации конкретных криптографических алгоритмов.
   В документацию также включены рекомендации по расширению функциональных возможностей библиотеки.

## Модель нарушителя

При рассмотрении возможной модели поведения нарушителя, то есть субъекта от которого  обеспечивается защита,
мы выбрали возможности, изложенные в рекомендациях по стандартизации Р 1323565.1.012-2017
«Информационная технология. Криптографическая защита информации.
Принципы разработки и модернизации шифровальных (криптографических) средств защиты информации».

Это привело к необходимости обеспечить защиту по следующим направлениям.

1. Защита от перехвата информации, передаваемой по открытым каналам связи или хранимой в открытом доступе;
   реализуется путем шифрования сетевого трафика и зашифрования хранящийеся информации;

2. Защита от непредсказуемых ошибок аппаратного обеспечения; приводит к необходимости
   контролировать целостность информации, в первую очередь ключевой информации,  в процессе ее обработки,
   а также реализовывать меры по маскированию криптографически опасной информации на случай
   незапланированного нарушения эксплуатации
   аппаратных средств и сброса ключевой информации на диск в незашифрованном виде;
   реализация данных мер содержится в классе \ref skey.

3. Защита от перехвата излучений и сигналов, вырабатываемых программными и аппаратными средствами,
   на которых выполняется защита информации; приводит к необходимости реализации мер защиты
   как от временных атак на исполняемый код, так и защите от побочных излучений по электро-магнитным
   каналам утечки информации (ПЭМИН);

4. Защита от преднамеренных действий пользователя, направленных на искажение обрабатываемой информации,
   определение используемой ключевой информации или нарушение логики работы функций библиотеки;
   приводит к необходимости создания функций внешнего интерфейса,
   являющихся прослойкой между пользователем и функциями внутреннего интерфейса,
   имеющими доступ к ключевой и обрабатываемой информации.

5. Ведение аудита выполненных библиотекой криптографических преобразоований и защита файлов аудита от
   преднамеренных или непреднамеренных искажений.

Для обеспечения защиты по указанным направлениям и обеспечения безопасности защищаемой информации
и исполняемого кода, мы сформулировали и реализовали ряд технических и организационных принципов
разработки исходных текстов. Данные принципы должны соблюдаться при модификации библиотеки и
расширении ее функциональных возможностей.


## Средства ограничения доступа к данным и ключевой информации

1. Каждому криптографическому преобразованию должен соответствовать уникальный класс
  (совокупность данных и методов их обработки),
   объекты которого могут разделять совместно только методы обработки данных, но не сами данные.
   Примером такого подхода к реализации является класс секретного ключа произвольного блочного
   алгоритма шифрования (см. класс \ref bckey). Каждый объект класса представляет собой ключ алгоритма шифрования,
   уникальный для каждого объекта. При этом методы - функции зашифрования и расширования -
   для всех ключей одного конкретного алгоритма шифрования совпадают.

2. Каждый класс должен иметь единооборазный набор конструкторов и деструкторов,
   что позволяет организовать унифицированный доступ к объектам, в частности, удаление объектов из памяти.

3. Создание объекта конкретного класса возможно только с помощью производящей функции.
   Любой другой механизм создания объектов считается недопустимым.

4. Описание конкретной реализации класса (полей структуры, типов, используемых при описании ее данных,
   перечень функций обработки данных) не экспортируется и не должно быть использовано за
   пределами исходных текстов библиотеки.

5. Механизмы работы с контекстами (указателями на созданные в ходе выполнения кода библиотеки объекты)
   не экспортируются. Указатели на созданные объекты не экспортируются.

6. Для доступа пользователя к объектам, создаваемым библиотекой, реализован механизм дескрипторов,
   которые однозначно связываются с конкретными объектами.

7. Значение дескриптора не должно нести в себе какой-либо информации о типе или каких-либо других характеристиках
   объекта с которым связан дескриптор. Данная информация должна предоставляться пользователю
   с помощью интерфейсных функций.

8. Функции для работы с дескрипторами являются функциями внешнего интерфейса (экспортируемыми функциями),
   функции для работы с создаваемыми объектами - функциями внутреннего интерфейса.
   Предварительное описание экспортируемых функций содержится в файле `libakrypt.h`.

9. Для обеспечения связи между экспортируемыми функциями внешнего интрефейса и функциями внутреннего
   интерфейса в библиотеке реализован
   менеджер контекстов, реализующий механизм хранения объектов создаваемых классов, связывания
   объектов с дескрипторами, доступными пользователю, и перенаправления запросов пользователя
   к функциям внутреннего интерфейса.

## Регламенитируемая последовательность действий

1. При старте библиотеки должен производиться контроль ее работоспособности для всех реализованных
   криптографических механизмов.

   * Минимальный набор тестов выполняется при вызове функции инфициализации библиотеки ak_libakrypt_create().
   * Полный набор тестов выполняется при вызове функции динамического контроля
     корректной работы криптографических механизмов ak_libakrypt_dynamic_control_test().

2. Библиотека должна вести аудит (документирование) возникающих в ходе ее выполнения ошибок
   исполнения программы, а также событий, определяемых в
   рекомендациях по стандартизации Р 1323565.1.012-2017.

3. При завершении работы библиотека должна самостоятельно контролировать очистку оперативной памяти,
   занимаемой созданными криптографическими объектами.
   Данный функционал возложен на функцию ak_libakrypt_destroy().

